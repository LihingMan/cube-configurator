<!Doctype html>
<html>
    <head>

        <meta charset="UTF-8">
        <title>ezbo</title>
        
        <!-- event handler for touch events -->
        <!-- <script> src="https://cdnjs.cloudflare.com/ajax/libs/jquery.pep/0.4.0/jquery.pep.min.js"</script>  -->
        <!-- earcut: polygon triangulation for webgl apps, required by babylon's polygon funcs -->

        <script src="https://unpkg.com/earcut@2.1.4/dist/earcut.min.js"></script>        

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <link rel="stylesheet" href="configurator_v2.css"> 

        <!-- babylon javascripts -->
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>

        <script src="babylonv4a.custom.js"></script>
    
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>

    </head> 

    <body>

        <canvas id="main_app"></canvas>

        <script src="configurator_v3_bryan.js"></script>

        <p class="price">
            <span id="price"></span>
        </p>

        <button class="price" id="saveAsImg">Save your work</button>
                    

        <div class="modal" id="pop-up-modal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title">
                            Accessories
                        </h1>
                    </div>
                    <div class="modal-body">
                        
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default" id="close" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="overlay">
            <div id="text">Use landscape mode</div>
        </div>

        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>

        <script>            
            var mql = window.matchMedia("(orientation: portrait)");
            // Add a media query change listener
            mql.addListener(function(m) {
                if(!m.matches) {
                    location.reload(true);
                }
            });

            // variables for storing quantity of cubes in scene
            /*var stackcube;
            var basecube;

            // variables for storing the cube price arrays
            var stackPrices = sessionStorage.getItem("stackCubePrices");
            stackPrices = JSON.parse(stackPrices);

            var basePrices = sessionStorage.getItem("baseCubePrices");
            basePrices = JSON.parse(basePrices);

            // variables to hold the prices
            var stack = 0;
            var base = 0;

            window.addEventListener("stack", function(){
                stackcube = sessionStorage.getItem("stackCubeCounter");
                stackcube = JSON.parse(stackcube);

                stack = calcPrice(stackPrices, stackcube);
                
                // document.getElementById("E1").textContent = stackcube[0].toString();
                // document.getElementById("E2").textContent = stackcube[1].toString();
                // document.getElementById("E3").textContent = stackcube[2].toString();
                // document.getElementById("E4").textContent = stackcube[3].toString();

                var curPrice = stack + base;
                document.getElementById("price").textContent = "RM" + curPrice;
            });

            window.addEventListener("base", function(){
                basecube = sessionStorage.getItem("baseCubeCounter");
                basecube = JSON.parse(basecube);

                base = calcPrice(basePrices, basecube);

                // document.getElementById("B1").textContent = basecube[0].toString();
                // document.getElementById("B2").textContent = basecube[1].toString();
                // document.getElementById("B3").textContent = basecube[2].toString();
                // document.getElementById("B4").textContent = basecube[3].toString();
                // document.getElementById("B5").textContent = basecube[4].toString();
                // document.getElementById("B6").textContent = basecube[5].toString();

                var curPrice = stack + base;
                document.getElementById("price").textContent = "RM" + curPrice;
            });*/

           // this is for the base cube manipulation popup
           $(document).ready(function () {
                window.addEventListener("popupBase", function(){  
                    var basecubeInt = sessionStorage.getItem("basecubeInt");
                    basecubeInt = JSON.parse(basecubeInt);
                    
                    if (basecubeInt == 1) {
                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf1'>Add X-Shelf to cube 1</button>");  // append button into modal
                    }
                    else if (basecubeInt == 2) {
                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf1'>Add X-Shelf to cube 1</button>");  // append button into modal

                        // $(".modal-body").append("<div class='divider'></div>"); // space between button
                        
                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf2'>Add X-Shelf to cube 2</button>");
                    }
                    else if (basecubeInt == 3) {
                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf1'>Add X-Shelf to cube 1</button>");  // append button into modal

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf2'>Add X-Shelf to cube 2</button>");

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf3'>Add X-Shelf to cube 3</button>");

                    }
                    else if (basecubeInt == 4) {
                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf1'>Add X-Shelfto cube 1</button>");  // append button into modal

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf2'>Add X-Shelf to cube 2</button>");

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf3'>Add X-Shelf to cube 3</button>");

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf4'>Add X-Shelf to cube 4</button>");
                    }
                    else if (basecubeInt == 5) {
                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf1'>Add X-Shelf to cube 1</button>");  // append button into modal
                        
                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf2'>Add X-Shelf to cube 2</button>");

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf3'>Add X-Shelf to cube 3</button>");

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf4'>Add X-Shelf to cube 4</button>");

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf5'>Add X-Shelf to cube 5</button>");
                    }
                    else if (basecubeInt == 6) {
                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf1'>Add X-Shelf to cube 1</button>");  // append button into modal

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf2'>Add X-Shelf to cube 2</button>");

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf3'>Add X-Shelf to cube 3</button>");

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf4'>Add X-Shelf to cube 4</button>");

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf5'>Add X-Shelf to cube 5</button>");

                        $(".modal-body").append("<button class='btn btn-primary' id='Xshelf6'>Add X-Shelf to cube 6</button>");
                    }

                    var modal = document.getElementById('pop-up-modal');
                    modal.style.display = "block";

                    $('.btn-primary').click(function(){ 
                        // update the basae cube accesory arrays here
                        var button = this.id;
                        button = parseInt(button[6]);
                        sessionStorage.setItem("whichCube", JSON.stringify(button));
                        makeEvent("importXshelfBase");
                    });  

                    $('#close').click(function(){ 
                        modal.style.display = "none";
                        $(".modal-body").html("");
                    });

                    // IF BLOCK OF CODE BELOW IS UNCOMMENTED THEN IT DOESNT WORK ON MOBILE

                    // window.addEventListener("click", function(event) {
                    //     // When the user clicks anywhere outside of the modal, close it
                    //     if (event.target == modal) {
                    //         modal.style.display = "none";
                    //         $(".modal-body").html("");
                    //     }
                    // });                      
                    
                }); 

                // this is for the stack cube manipulation popup
                window.addEventListener("popupStack", function(){  

                    // for now this is only a temporary thing. 

                    $(".modal-body").append("<button class='btn btn-primary' id='Xshelf'>Add X-Shelf to stack</button>");  // append button into modal

                    var modal = document.getElementById('pop-up-modal');
                    modal.style.display = "block";

                    // event to import X shelf
                    $('.btn-primary').click(function(){ 
                        // update the stack cube accesory arrays here
                        makeEvent("importXshelfStack");
                    });                  

                    $('#close').click(function(){ 
                        modal.style.display = "none";
                        $(".modal-body").html("");
                    });
                });

                $("#saveAsImg").click(function(){
                    makeEvent("saveScene");
                })
            });

        

            function calcPrice(prices, cubeArr){
                var total = 0;
                for (var i=0; i<prices.length; i++){
                    if (cubeArr[i] > 0){
                        total += prices[i]*cubeArr[i];
                    }
                }
                
                return total
            }
        
        </script>        
    </body>
</html>    